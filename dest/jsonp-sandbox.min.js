!function(e){"use strict";function n(){}function o(){this.sandbox=document.createElement("iframe"),this.sandbox.style.display="none",this._setSandboxSrcodc(this._getSandboxCode()),(document.body||document.documentElement).appendChild(this.sandbox),this.sandbox.sandbox="allow-scripts"}var t="#"+Math.random(),s=0;o._callbacks={},o._onmessage=function(n){n=n||e.event;var t=n.data;if(e.JSON&&"string"==typeof t)try{t=JSON.parse(t)}catch(s){t={}}var a=t.id,r=o._callbacks;r.hasOwnProperty(a)&&(r=r[a],t.error?r[1](t.error):r[0](t.response),delete r[a])},o.prototype={constructor:o,get:function(a){"string"==typeof a&&(a={url:a,success:arguments[1],error:arguments[2]});var r=a.url,d=a.key||"callback",c=a.value||"jsonp"+s,i=a.success||n,u=a.error||n,l=a.data||{},p=e.encodeURIComponent,b=[];for(var f in l)b.push(p(f)+"="+p(l[f]));b=b.join("&"),r=/\?/.test(r)?r+b:r+"?"+b,s++;var h=s+t;o._callbacks[h]=[i,u],this._postMessage({id:h,url:r,value:c,key:d})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_setSandboxSrcodc:function(e){var n,o=this.sandbox;"srcdoc"in o?o.srcdoc=e:(this.sandbox.src="about:blank",n=o.contentWindow.document,n.open(),n.write(e),n.close())},_getSandboxCode:function(){return"<html><head></head><body><script>("+function(e){function n(n){n.error&&(n.error=n.error.toString()),e.JSON&&(n=JSON.stringify(n)),e.parent.postMessage(n,"*")}function o(e,n){var o=arguments[2]||"",t=+new Date,s=e.replace(/([?&])_=[^&]*/,"$1_="+t);e=s+(s===e?(/\?/.test(e)?"&":"?")+"_="+t:""),e+=o;var a=document.createElement("script");a.onload=a.onreadystatechange=function(){var e=!a.readyState||/loaded|complete/.test(a.readyState);e&&(a.onload=a.onreadystatechange=null,document.body.removeChild(a),n&&n(null))},a.onerror=function(){n(new Error("Failed to load: "+a.src))},a.src=e,document.body.appendChild(a)}e.onmessage=function(t){function s(e){e||"undefined"!=typeof a.response||(e=new Error("Wrong format.")),e&&(a.error=e),n(a)}t=t||e.event;var a=t.data;e.JSON&&(a=JSON.parse(a));var r=a.value,d=a.url,c=a.key;e[r]=function(n){a.response=n,e[r]=null},o(d,s,"&"+encodeURIComponent(c)+"="+encodeURIComponent(r))},e.postMessage||(e.postMessage=function(n){e.onmessage({data:n})}),e.onerror=function(e){console.warn("JSONP.Sandbox:",e)}}.toString()+")(window)</script></body></html>"},_postMessage:function(n){var o=this;!this._sandboxReady&&"srcdoc"in this.sandbox?(this.sandbox.onload||(this._queue=[],this.sandbox.onload=function(){o._sandboxReady=!0;for(var e=0;e<o._queue.length;e++)o._postMessage(o._queue[e]);delete o.sandbox.onload,delete o._queue}),this._queue.push(n)):(e.JSON&&(n=JSON.stringify(n)),this.sandbox.contentWindow.postMessage(n,"*"))}},e.postMessage?e.addEventListener?e.addEventListener("message",o._onmessage,!1):e.attachEvent("onmessage",o._onmessage):e.postMessage||(e.postMessage=function(e){o._onmessage({data:e})});var a={get:function(){a._sandbox||(a._sandbox=new o),a._sandbox.get.apply(a._sandbox,arguments)},Sandbox:o};"function"==typeof define?define(function(){return a}):"object"==typeof module?module.exports=a:e.JSONP=a}(window);
!function(e){"use strict";function o(){this.sandbox=this._createSandbox()}var n="#"+Math.random(),t=0,s=e.postMessage&&e.JSON;o._callbacks={},o._onmessage=function(n){n=n||e.event;var t=n.data;if(e.JSON&&"string"==typeof t)try{t=JSON.parse(t)}catch(s){t={}}var a=t.id,r=o._callbacks;r.hasOwnProperty(a)&&(r=r[a],t.error?r[1](t.error):r[0](t.response),delete r[a])},o.prototype={constructor:o,get:function(s){function a(){}"string"==typeof s&&(s={url:s,success:arguments[1],error:arguments[2]}),t++;var r=s.url,d=s.key||"callback",i=s.value||"jsonp"+t,c=s.success||a,u=s.error||a,l=s.data||{},p=s.cache!==!1,f=s.timeout||0,m=e.encodeURIComponent,h=[];for(var g in l)h.push(m(g)+"="+m(l[g]));p&&h.push("_="+ +new Date),h.push(m(d)+"="+m(i)),h=h.join("&"),r=/\?/.test(r)?r+"&"+h:r+"?"+h;var _=t+n;o._callbacks[_]=[c,u],this._postMessage({id:_,url:r,value:i,timeout:f})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_createSandbox:function(){var e=document.createElement("iframe"),o=document.body||document.documentElement;e.style.display="none",o.appendChild(e);var n=this._getSandboxCode(),t=e.contentWindow.document;return e.sandbox="allow-scripts","srcdoc"in e?e.srcdoc=n:(t=e.contentWindow.document,t.open(),t.write(n),t.close()),e},_postMessage:function(o){var n=this,t=this.sandbox;!this._sandboxReady&&"srcdoc"in t?(t.onload||(this._queue=[],t.onload=function(){n._sandboxReady=!0;for(var e=0;e<n._queue.length;e++)n._postMessage(n._queue[e]);delete t.onload,delete n._queue}),this._queue.push(o)):(e.JSON&&(o=JSON.stringify(o)),t.contentWindow.postMessage(o,"*"))},_getSandboxCode:function(){return"<html><head></head><body><script>("+function(e,o,n,t,s,a,r,d,i,c,u){function l(e){e.error&&(e.error=e.error.toString()),s&&(e=s.stringify(e)),f?o.postMessage(e,"*"):o.__postMessage__(e,"*")}function p(e,o,n){var t=u.call(i,"script");t.onload=t.onreadystatechange=function(){var e=!t.readyState||/loaded|complete/.test(t.readyState);e&&(t.onload=t.onreadystatechange=null,c.removeChild(t),o())},t.onerror=n,t.src=e,c.appendChild(t)}var f=t&&s;if(n){var m=[],h=e,g={console:!0,onmessage:!0,postMessage:!0,event:!0};for(var _ in h)g[_]||m.push("function "+_+"(){}");m=m.join(""),n(m)}a&&Object.keys(a.prototype).forEach(function(e){"close"!==e&&delete a.prototype[e]}),e.onmessage=function(o){function n(){a||(f&&d(t),l(i),a=!0)}o=o||e.event;var t,a,i=o.data;s&&(i=s.parse(i));var c=i.value,u=i.url,f=i.timeout;e[c]=function(o){i.response=o,e[c]=null},f&&(t=r(function(){i.error=new Error("Timeout."),n()},f)),p(u,function(){"undefined"==typeof i.response&&(i.error=new Error("Wrong format.")),n()},function(){i.error=new Error("Failed to load: "+u),n()})},f||(e.postMessage=function(o){e.onmessage({data:o})}),e.onerror=function(e){console.warn("JSONP.Sandbox:",e)}}.toString()+")("+["window","parent","window.execScript","window.postMessage","window.JSON","window.Document","setTimeout","clearTimeout","document","document.body","document.createElement"].join(",")+")</script></body></html>"}},s?e.addEventListener?e.addEventListener("message",o._onmessage,!1):e.attachEvent("onmessage",o._onmessage):e.__postMessage__=function(e){o._onmessage({data:e})};var a={get:function(){a._sandbox||(a._sandbox=new o),a._sandbox.get.apply(a._sandbox,arguments)},Sandbox:o};"function"==typeof define?define(function(){return a}):"object"==typeof module?module.exports=a:e.JSONP=a}(window);
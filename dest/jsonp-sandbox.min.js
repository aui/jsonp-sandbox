!function(e,o){"use strict";function n(){this.sandbox=this._createSandbox()}n._callbacks={},n._count=0,n._token="#"+Math.random(),n._onmessage=function(e){var o=e.data;if("object"==typeof o&&null!==o){var t=o.id,a=n._callbacks;a.hasOwnProperty(t)&&(a=a[t],o.error?a[1](o.error):a[0](o.response),delete a[t])}},n.prototype={constructor:n,get:function(o){function t(){}if(!this.sandbox)throw new Error("JSONP.Sandbox has been destroyed.");"string"==typeof o&&(o={url:o,success:arguments[1],error:arguments[2]}),n._count++;var a=o.url,r=o.key||"callback",s=o.value||"jsonp"+n._count,c=o.success||t,i=o.error||t,d=o.data||{},u=o.cache!==!1,l=o.timeout||0,f=e.encodeURIComponent,p=[];for(var _ in d)p.push(f(_)+"="+f(d[_]));u&&p.push("_="+ +new Date),p.push(f(r)+"="+f(s)),p=p.join("&"),a=/\?/.test(a)?a+"&"+p:a+"?"+p;var b=n._count+n._token;n._callbacks[b]=[c,i],this._postMessage({id:b,url:a,value:s,timeout:l})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_createSandbox:function(){var e=document.createElement("iframe"),n=document.body||document.documentElement;e.style.display="none",n.appendChild(e);var t=this._getSandboxCode(),a=e.contentWindow.document;return o&&(e.sandbox="allow-scripts"),"srcdoc"in e?e.srcdoc=t:(a=e.contentWindow.document,a.open(),a.write(t),a.close()),e},_postMessage:function(e){var n=this,t=this.sandbox,a=t.contentWindow;!this._sandboxReady&&"srcdoc"in t?(t.onload||(this._queue=[],t.onload=function(){n._sandboxReady=!0;for(var e=0;e<n._queue.length;e++)n._postMessage(n._queue[e]);delete t.onload,delete n._queue}),this._queue.push(e)):o?a.postMessage(e,"*"):a.__postMessage__(e)},_getSandboxCode:function(){var e=[o,"window","parent","document","setTimeout","clearTimeout"],n=function(e,o,n,t,a,r){function s(){function e(e){var n=o[e];if(n){var t=n.prototype;for(var a in t)if("close"!==a)try{delete t[a]}catch(r){}}}e("Node"),e("Document"),e("HTMLDocument")}function c(){var e=[],n=o;n.ActiveXObject=!0;var t={postMessage:!0,console:!0,location:!0};for(var a in n)if(!t[a]){try{delete o[a]}catch(r){}a in o&&e.push("function "+a+"(){}")}e=e.join(""),o.execScript&&execScript(e)}function i(e,o,n){var a=f.call(t,"script");a.onload=a.onreadystatechange=function(){var e=!a.readyState||/loaded|complete/.test(a.readyState);e&&(a.onload=a.onreadystatechange=null,b.call(p,a),o())},a.onerror=n,a.src=e,_.call(p,a)}function d(o){o.error&&(o.error=o.error.toString()),e?n.postMessage(o,"*"):n.__postMessage__(o)}function u(e){function n(){s||(f&&r(t),d(c),s=!0)}var t,s,c=e.data,u=c.value,l=c.url,f=c.timeout;o[u]=function(e){c.response=e,o[u]=null},f&&(t=a(function(){c.error=new Error("Timeout."),n()},f)),i(l,function(){"undefined"==typeof c.response&&(c.error=new Error("Wrong format.")),n()},function(){c.error=new Error("Failed to load: "+l),n()})}var l=o.addEventListener,f=t.createElement,p=t.body,_=p.appendChild,b=p.removeChild;c(),s(),o.onerror=function(e){console.warn("JSONP.Sandbox:",e)},e?l("message",u,!1):(o.__postMessage__=function(e){u({data:e})},l&&l("unload",function(){location.href="about:blank"}))};return"<html><head></head><body><script>("+n.toString()+")("+e.join(",")+")</script></body></html>"}},o?e.addEventListener("message",n._onmessage,!1):e.__postMessage__=function(e){n._onmessage({data:e})};var t={get:function(){t._sandbox||(t._sandbox=new n),t._sandbox.get.apply(t._sandbox,arguments)},Sandbox:n};"function"==typeof define?define(function(){return t}):"object"==typeof module?module.exports=t:e.JSONP=t}(window,window.HTMLIFrameElement?"sandbox"in HTMLIFrameElement.prototype:!1);
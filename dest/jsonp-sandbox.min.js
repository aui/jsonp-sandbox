!function(e){"use strict";function o(){this.sandbox=this._createSandbox()}var n="#"+Math.random(),t=0,r=e.HTMLIFrameElement?"sandbox"in HTMLIFrameElement.prototype:!1;o._callbacks={},o._onmessage=function(e){var n=e.data;if("object"==typeof n&&null!==n){var t=n.id,r=o._callbacks;r.hasOwnProperty(t)&&(r=r[t],n.error?r[1](n.error):r[0](n.response),delete r[t])}},o.prototype={constructor:o,get:function(r){function a(){}"string"==typeof r&&(r={url:r,success:arguments[1],error:arguments[2]}),t++;var s=r.url,d=r.key||"callback",c=r.value||"jsonp"+t,i=r.success||a,u=r.error||a,l=r.data||{},p=r.cache!==!1,f=r.timeout||0,_=e.encodeURIComponent,m=[];for(var b in l)m.push(_(b)+"="+_(l[b]));p&&m.push("_="+ +new Date),m.push(_(d)+"="+_(c)),m=m.join("&"),s=/\?/.test(s)?s+"&"+m:s+"?"+m;var h=t+n;o._callbacks[h]=[i,u],this._postMessage({id:h,url:s,value:c,timeout:f})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_createSandbox:function(){var e=document.createElement("iframe"),o=document.body||document.documentElement;e.style.display="none",o.appendChild(e);var n=this._getSandboxCode(r),t=e.contentWindow.document;return r&&(e.sandbox="allow-scripts"),"srcdoc"in e?e.srcdoc=n:(t=e.contentWindow.document,t.open(),t.write(n),t.close()),e},_postMessage:function(e){var o=this,n=this.sandbox,t=n.contentWindow,a=r?"postMessage":"__postMessage__";!this._sandboxReady&&"srcdoc"in n?(n.onload||(this._queue=[],n.onload=function(){o._sandboxReady=!0;for(var e=0;e<o._queue.length;e++)o._postMessage(o._queue[e]);delete n.onload,delete o._queue}),this._queue.push(e)):t[a](e,"*")},_getSandboxCode:function(e){var o=[e,"window","parent","window.execScript","window.Document","setTimeout","clearTimeout","document","document.body","document.createElement"],n=function(e,o,n,t,r,a,s,d,c,i){function u(e,o,n){var t=i.call(d,"script");t.onload=t.onreadystatechange=function(){var e=!t.readyState||/loaded|complete/.test(t.readyState);e&&(t.onload=t.onreadystatechange=null,c.removeChild(t),o())},t.onerror=n,t.src=e,c.appendChild(t)}function l(o){var t=e?"postMessage":"__postMessage__";o.error&&(o.error=o.error.toString()),n[t](o,"*")}function p(e){function n(){r||(p&&s(t),l(d),r=!0)}var t,r,d=e.data,c=d.value,i=d.url,p=d.timeout;o[c]=function(e){d.response=e,o[c]=null},p&&(t=a(function(){d.error=new Error("Timeout."),n()},p)),u(i,function(){"undefined"==typeof d.response&&(d.error=new Error("Wrong format.")),n()},function(){d.error=new Error("Failed to load: "+i),n()})}if(!e&&t){var f=[],_=o,m={console:!0};for(var b in _)m[b]||f.push("function "+b+"(){}");f=f.join(""),t(f)}r&&Object.keys(r.prototype).forEach(function(e){"close"!==e&&delete r.prototype[e]}),o.onerror=function(e){console.warn("JSONP.Sandbox:",e)},e?o.addEventListener("message",p,!1):o.__postMessage__=function(e){p({data:e})}};return"<html><head></head><body><script>("+n.toString()+")("+o.join(",")+")</script></body></html>"}},r?e.addEventListener("message",o._onmessage,!1):e.__postMessage__=function(e){o._onmessage({data:e})};var a={get:function(){a._sandbox||(a._sandbox=new o),a._sandbox.get.apply(a._sandbox,arguments)},Sandbox:o};"function"==typeof define?define(function(){return a}):"object"==typeof module?module.exports=a:e.JSONP=a}(window);
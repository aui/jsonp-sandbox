!function(e){"use strict";function o(){this.sandbox=document.createElement("iframe"),this.sandbox.style.display="none",(document.body||document.documentElement).appendChild(this.sandbox),this._setSandboxSrcodc(this._getSandboxCode()),this.sandbox.sandbox="allow-scripts"}var n=Math.random(),t=0;o._callbacks={},o._onmessage=function(e){var t=e.data;if("string"==typeof t)try{t=JSON.parse(t)}catch(a){t={}}var s=t.token,r=t.JSONP_ID,d=o._callbacks;s===n&&d.hasOwnProperty(r)&&(d[r](t.error,t.data),delete d[r])},o.prototype={constructor:o,get:function(e,a,s){"function"==typeof a&&(s=a,a={}),a||(a={}),t++;var r=encodeURIComponent(a.value||"jsonp"+t);o._callbacks[r]=s,this._postMessage({token:n,JSONP_ID:r,key:a.key||"callback",data:null,url:e})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_setSandboxSrcodc:function(e){var o,n=this.sandbox;"srcdoc"in n?n.srcdoc=e:(this.sandbox.src="about:blank",o=n.contentWindow.document,o.open(),o.write(e),o.close())},_getSandboxCode:function(){return"<html><head></head><body><script>("+function(e){function o(o){o.error&&(o.error=o.error.toString()),"object"==typeof o&&(o=JSON.stringify(o)),e.parent.postMessage(o,"*")}function n(e,o){var n=arguments[2]||"",t=+new Date,a=e.replace(/([?&])_=[^&]*/,"$1_="+t);e=a+(a===e?(/\?/.test(e)?"&":"?")+"_="+t:""),e+=n;var s=document.createElement("script");s.onload=s.onreadystatechange=function(){var e=!s.readyState||/loaded|complete/.test(s.readyState);e&&(s.onload=s.onreadystatechange=null,document.body.removeChild(s),o&&o(null))},s.onerror=function(){o(new Error("Failed to load: "+s.src))},s.src=e,document.body.appendChild(s)}e.onmessage=function(t){function a(n){n?(s.error=n,o(s),e[r]=null):e[r]&&(s.error=new Error("Wrong format."),o(s))}var s=t.data;"string"==typeof s&&(s=JSON.parse(s));var r=s.JSONP_ID,d=s.url,i=s.key;e[r]=function(n){s.data=n,o(s),e[r]=null},n(d,a,"&"+i+"="+r)},"function"!=typeof e.postMessage&&(e.postMessage=function(o){e.onmessage.call(e,{data:o})}),e.onerror=function(e){console.error("JsonpSandboxError:",e)}}.toString()+")(window)</script></body></html>"},_postMessage:function(e){var o=this;!this._sandboxReady&&"srcdoc"in this.sandbox?(this.sandbox.onload||(this._queue=[],this.sandbox.onload=function(){o._sandboxReady=!0;for(var e=0;e<o._queue.length;e++)o._postMessage(o._queue[e]);delete o.sandbox.onload,delete o._queue}),this._queue.push(e)):(e=JSON.stringify(e),this.sandbox.contentWindow.postMessage(e,"*"))}},"onmessage"in e&&"addEventListener"in e?e.addEventListener("message",o._onmessage,!1):e.postMessage=function(e){o._onmessage({origin:"null",data:e})};var a={get:function(){a._sandbox||(a._sandbox=new o),a._sandbox.get.apply(a._sandbox,arguments)},Sandbox:o};"function"==typeof define?define(function(){return a}):"object"==typeof module?module.exports=a:e.JSONP=a}(window);
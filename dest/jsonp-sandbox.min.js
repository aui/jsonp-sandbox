!function(e,o){"use strict";function n(){this.sandbox=this._createSandbox()}n._callbacks={},n._count=0,n._token="#"+Math.random(),n._onmessage=function(e){var o=e.data;if("object"==typeof o&&null!==o){var t=o.id,r=n._callbacks;r.hasOwnProperty(t)&&(r=r[t],o.error?r[1](o.error):r[0](o.response),delete r[t])}},n.prototype={constructor:n,get:function(o){function t(){}"string"==typeof o&&(o={url:o,success:arguments[1],error:arguments[2]}),n._count++;var r=o.url,a=o.key||"callback",s=o.value||"jsonp"+n._count,c=o.success||t,i=o.error||t,d=o.data||{},u=o.cache!==!1,l=o.timeout||0,p=e.encodeURIComponent,f=[];for(var _ in d)f.push(p(_)+"="+p(d[_]));u&&f.push("_="+ +new Date),f.push(p(a)+"="+p(s)),f=f.join("&"),r=/\?/.test(r)?r+"&"+f:r+"?"+f;var m=n._count+n._token;n._callbacks[m]=[c,i],this._postMessage({id:m,url:r,value:s,timeout:l})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_createSandbox:function(){var e=document.createElement("iframe"),n=document.body||document.documentElement;e.style.display="none",n.appendChild(e);var t=this._getSandboxCode(),r=e.contentWindow.document;return o&&(e.sandbox="allow-scripts"),"srcdoc"in e?e.srcdoc=t:(r=e.contentWindow.document,r.open(),r.write(t),r.close()),e},_postMessage:function(e){var n=this,t=this.sandbox,r=t.contentWindow;!this._sandboxReady&&"srcdoc"in t?(t.onload||(this._queue=[],t.onload=function(){n._sandboxReady=!0;for(var e=0;e<n._queue.length;e++)n._postMessage(n._queue[e]);delete t.onload,delete n._queue}),this._queue.push(e)):o?r.postMessage(e,"*"):r.__postMessage__(e)},_getSandboxCode:function(){var e=[o,"window","parent","document","setTimeout","clearTimeout"],n=function(e,o,n,t,r,a){function s(){function e(e){var n=o[e];if(n){var t=n.prototype;for(var r in t)if("close"!==r)try{delete t[r]}catch(a){}}}e("Node"),e("Document"),e("HTMLDocument")}function c(){var e=[],n=o;n.ActiveXObject=!0;var t={postMessage:!0,console:!0,location:!0};for(var r in n)if(!t[r]){try{delete o[r]}catch(a){}r in o&&e.push("function "+r+"(){}")}e=e.join(""),o.execScript&&execScript(e)}function i(e,o,n){var r=p.call(t,"script");r.onload=r.onreadystatechange=function(){var e=!r.readyState||/loaded|complete/.test(r.readyState);e&&(r.onload=r.onreadystatechange=null,m.call(f,r),o())},r.onerror=n,r.src=e,_.call(f,r)}function d(o){o.error&&(o.error=o.error.toString()),e?n.postMessage(o,"*"):n.__postMessage__(o)}function u(e){function n(){s||(p&&a(t),d(c),s=!0)}var t,s,c=e.data,u=c.value,l=c.url,p=c.timeout;o[u]=function(e){c.response=e,o[u]=null},p&&(t=r(function(){c.error=new Error("Timeout."),n()},p)),i(l,function(){"undefined"==typeof c.response&&(c.error=new Error("Wrong format.")),n()},function(){c.error=new Error("Failed to load: "+l),n()})}var l=o.addEventListener,p=t.createElement,f=t.body,_=f.appendChild,m=f.removeChild;c(),s(),o.onerror=function(e){console.warn("JSONP.Sandbox:",e)},e?l("message",u,!1):o.__postMessage__=function(e){u({data:e})}};return"<html><head></head><body><script>("+n.toString()+")("+e.join(",")+")</script></body></html>"}},o?e.addEventListener("message",n._onmessage,!1):e.__postMessage__=function(e){n._onmessage({data:e})};var t={get:function(){t._sandbox||(t._sandbox=new n),t._sandbox.get.apply(t._sandbox,arguments)},Sandbox:n};"function"==typeof define?define(function(){return t}):"object"==typeof module?module.exports=t:e.JSONP=t}(window,window.HTMLIFrameElement?"sandbox"in HTMLIFrameElement.prototype:!1);
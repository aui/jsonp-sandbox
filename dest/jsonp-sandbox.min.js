!function(e){"use strict";function n(){this.sandbox=this._createSandbox()}var o="#"+Math.random(),t=0,s=e.postMessage&&e.JSON;n._callbacks={},n._onmessage=function(o){o=o||e.event;var t=o.data;if(e.JSON&&"string"==typeof t)try{t=JSON.parse(t)}catch(s){t={}}var a=t.id,r=n._callbacks;r.hasOwnProperty(a)&&(r=r[a],t.error?r[1](t.error):r[0](t.response),delete r[a])},n.prototype={constructor:n,get:function(s){function a(){}"string"==typeof s&&(s={url:s,success:arguments[1],error:arguments[2]});var r=s.url,d=s.key||"callback",c=s.value||"jsonp"+t,i=s.success||a,u=s.error||a,l=s.data||{},p=e.encodeURIComponent,f=[];for(var _ in l)f.push(p(_)+"="+p(l[_]));f=f.join("&"),r=/\?/.test(r)?r+f:r+"?"+f,t++;var g=t+o;n._callbacks[g]=[i,u],this._postMessage({id:g,url:r,value:c,key:d})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_createSandbox:function(){var e=document.createElement("iframe"),n=document.body||document.documentElement;e.style.display="none",n.appendChild(e);var o=this._getSandboxCode(),t=e.contentWindow.document;return e.sandbox="allow-scripts","srcdoc"in e?e.srcdoc=o:(t=e.contentWindow.document,t.open(),t.write(o),t.close()),e},_postMessage:function(n){var o=this,t=this.sandbox;!this._sandboxReady&&"srcdoc"in t?(t.onload||(this._queue=[],t.onload=function(){o._sandboxReady=!0;for(var e=0;e<o._queue.length;e++)o._postMessage(o._queue[e]);delete t.onload,delete o._queue}),this._queue.push(n)):(e.JSON&&(n=JSON.stringify(n)),t.contentWindow.postMessage(n,"*"))},_getSandboxCode:function(){return"<html><head></head><body><script>("+function(e,n,o,t,s,a,r,d,c){function i(e){e.error&&(e.error=e.error.toString()),s&&(e=s.stringify(e)),l?n.postMessage(e,"*"):n.__postMessage__(e,"*")}function u(e,n){var o=arguments[2]||"",t=+new Date,s=e.replace(/([?&])_=[^&]*/,"$1_="+t);e=s+(s===e?(/\?/.test(e)?"&":"?")+"_="+t:""),e+=o;var a=c.call(r,"script");a.onload=a.onreadystatechange=function(){var e=!a.readyState||/loaded|complete/.test(a.readyState);e&&(a.onload=a.onreadystatechange=null,d.removeChild(a),n&&n(null))},a.onerror=function(){n(new Error("Failed to load: "+a.src))},a.src=e,d.appendChild(a)}var l=t&&s;if(o){var p=[],f=e,_={console:!0,onmessage:!0,postMessage:!0,event:!0};for(var g in f)_[g]||p.push("function "+g+"(){}");p=p.join(""),o(p)}a&&Object.keys(a.prototype).forEach(function(e){"close"!==e&&delete a.prototype[e]}),e.onmessage=function(n){function o(e){e||"undefined"!=typeof t.response||(e=new Error("Wrong format.")),e&&(t.error=e),i(t)}n=n||e.event;var t=n.data;s&&(t=s.parse(t));var a=t.value,r=t.url,d=t.key;e[a]=function(n){t.response=n,e[a]=null},u(r,o,"&"+encodeURIComponent(d)+"="+encodeURIComponent(a))},l||(e.postMessage=function(n){e.onmessage({data:n})}),e.onerror=function(e){console.warn("JSONP.Sandbox:",e)}}.toString()+")("+["window","parent","window.execScript","window.postMessage","window.JSON","window.Document","document","document.body","document.createElement"].join(",")+")</script></body></html>"}},s?e.addEventListener?e.addEventListener("message",n._onmessage,!1):e.attachEvent("onmessage",n._onmessage):e.__postMessage__=function(e){n._onmessage({data:e})};var a={get:function(){a._sandbox||(a._sandbox=new n),a._sandbox.get.apply(a._sandbox,arguments)},Sandbox:n};"function"==typeof define?define(function(){return a}):"object"==typeof module?module.exports=a:e.JSONP=a}(window);
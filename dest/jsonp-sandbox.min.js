!function(n){"use strict";function o(){this.sandbox=document.createElement("iframe"),this.sandbox.style.display="none",(document.body||document.documentElement).appendChild(this.sandbox),this._setSandboxSrcodc(this._getSandboxCode()),this.sandbox.sandbox="allow-scripts"}o._callbacks={},o._onmessage=function(n){var e=n.data;if("string"==typeof e)try{e=JSON.parse(e)}catch(t){e={}}var a=e.JSONP_ID,s=o._callbacks;a&&s.hasOwnProperty(a)&&(s[a](e.error,e.data),delete s[a])},o._count=0,o.prototype={constructor:o,get:function(n,e,t){"function"==typeof e&&(t=e,e={}),e||(e={}),o._count++;var a=encodeURIComponent(e.name||"jsonp"+o._count);o._callbacks[a]=t,this._postMessage({JSONP_ID:a,param:e.param||"callback",data:null,url:n})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_setSandboxSrcodc:function(n){var o,e=this.sandbox;"srcdoc"in e?e.srcdoc=n:(this.sandbox.src="about:blank",o=e.contentWindow.document,o.open(),o.write(n),o.close())},_getSandboxCode:function(){return"<html><head></head><body><script>("+function(n){function o(o){o.error&&(o.error=o.error.toString()),"object"==typeof o&&(o=JSON.stringify(o)),n.parent.postMessage(o,"*")}function e(n,o){var e=arguments[2]||"",t=+new Date,a=n.replace(/([?&])_=[^&]*/,"$1_="+t);n=a+(a===n?(/\?/.test(n)?"&":"?")+"_="+t:""),n+=e;var s=document.createElement("script");s.onload=s.onreadystatechange=function(){var n=!s.readyState||/loaded|complete/.test(s.readyState);n&&(s.onload=s.onreadystatechange=null,document.body.removeChild(s),o&&o(null))},s.onerror=function(){o(new Error("Failed to load: "+s.src))},s.src=n,document.body.appendChild(s)}n.onmessage=function(t){function a(e){e?(s.error=e,o(s),n[r]=null):n[r]&&(s.error=new Error("Wrong format."),o(s))}var s=t.data;"string"==typeof s&&(s=JSON.parse(s));var r=s.JSONP_ID,d=s.url,c=s.param;n[r]=function(e){s.data=e,o(s),n[r]=null},e(d,a,"&"+c+"="+r)},"function"!=typeof n.postMessage&&(n.postMessage=function(o){n.onmessage.call(n,{data:o})}),n.onerror=function(n){console.error("JsonpSandboxError:",n)}}.toString()+")(window)</script></body></html>"},_postMessage:function(n){var o=this;!this._sandboxReady&&"srcdoc"in this.sandbox?(this.sandbox.onload||(this._queue=[],this.sandbox.onload=function(){o._sandboxReady=!0;for(var n=0;n<o._queue.length;n++)o._postMessage(o._queue[n]);delete o.sandbox.onload,delete o._queue}),this._queue.push(n)):(n=JSON.stringify(n),this.sandbox.contentWindow.postMessage(n,"*"))}},"onmessage"in n&&"addEventListener"in n?n.addEventListener("message",o._onmessage,!1):n.postMessage=function(n){o._onmessage({origin:"null",data:n})};var e={get:function(){e._sandbox||(e._sandbox=new o),e._sandbox.get.apply(e._sandbox,arguments)},Sandbox:o};"function"==typeof define?define(function(){return e}):"object"==typeof module?module.exports=e:n.JSONP=e}(window);
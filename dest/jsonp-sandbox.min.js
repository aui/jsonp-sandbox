!function(e,o){"use strict";function n(){this.sandbox=this._createSandbox()}n._callbacks={},n._count=0,n._token="#"+Math.random(),n._onmessage=function(e){var o=e.data;if("object"==typeof o&&null!==o){var t=o.id,r=n._callbacks;r.hasOwnProperty(t)&&(r=r[t],o.error?r[1](o.error):r[0](o.response),delete r[t])}},n.prototype={constructor:n,get:function(o){function t(){}"string"==typeof o&&(o={url:o,success:arguments[1],error:arguments[2]}),n._count++;var r=o.url,a=o.key||"callback",s=o.value||"jsonp"+n._count,c=o.success||t,d=o.error||t,i=o.data||{},u=o.cache!==!1,l=o.timeout||0,p=e.encodeURIComponent,_=[];for(var f in i)_.push(p(f)+"="+p(i[f]));u&&_.push("_="+ +new Date),_.push(p(a)+"="+p(s)),_=_.join("&"),r=/\?/.test(r)?r+"&"+_:r+"?"+_;var m=n._count+n._token;n._callbacks[m]=[c,d],this._postMessage({id:m,url:r,value:s,timeout:l})},destroy:function(){this.sandbox.src="about:blank",this.sandbox.srcdoc="",this.sandbox.parentNode.removeChild(this.sandbox),this.sandbox=null},_createSandbox:function(){var e=document.createElement("iframe"),n=document.body||document.documentElement;e.style.display="none",n.appendChild(e);var t=this._getSandboxCode(o),r=e.contentWindow.document;return o&&(e.sandbox="allow-scripts"),"srcdoc"in e?e.srcdoc=t:(r=e.contentWindow.document,r.open(),r.write(t),r.close()),e},_postMessage:function(e){var n=this,t=this.sandbox,r=t.contentWindow,a=o?"postMessage":"__postMessage__";!this._sandboxReady&&"srcdoc"in t?(t.onload||(this._queue=[],t.onload=function(){n._sandboxReady=!0;for(var e=0;e<n._queue.length;e++)n._postMessage(n._queue[e]);delete t.onload,delete n._queue}),this._queue.push(e)):r[a](e,"*")},_getSandboxCode:function(e){var o=[e,"window","parent","window.execScript","window.Document","setTimeout","clearTimeout","document","document.body","document.createElement"],n=function(e,o,n,t,r,a,s,c,d,i){function u(e,o,n){var t=i.call(c,"script");t.onload=t.onreadystatechange=function(){var e=!t.readyState||/loaded|complete/.test(t.readyState);e&&(t.onload=t.onreadystatechange=null,d.removeChild(t),o())},t.onerror=n,t.src=e,d.appendChild(t)}function l(o){var t=e?"postMessage":"__postMessage__";o.error&&(o.error=o.error.toString()),n[t](o,"*")}function p(e){function n(){r||(p&&s(t),l(c),r=!0)}var t,r,c=e.data,d=c.value,i=c.url,p=c.timeout;o[d]=function(e){c.response=e,o[d]=null},p&&(t=a(function(){c.error=new Error("Timeout."),n()},p)),u(i,function(){"undefined"==typeof c.response&&(c.error=new Error("Wrong format.")),n()},function(){c.error=new Error("Failed to load: "+i),n()})}if(!e&&t){var _=[],f=o;f.ActiveXObject=!0;var m={console:!0};for(var b in f)m[b]||_.push("function "+b+"(){}");_=_.join(""),t(_)}r&&Object.keys(r.prototype).forEach(function(e){"close"!==e&&delete r.prototype[e]}),o.onerror=function(e){console.warn("JSONP.Sandbox:",e)},e?o.addEventListener("message",p,!1):o.__postMessage__=function(e){p({data:e})}};return"<html><head></head><body><script>("+n.toString()+")("+o.join(",")+")</script></body></html>"}},o?e.addEventListener("message",n._onmessage,!1):e.__postMessage__=function(e){n._onmessage({data:e})};var t={get:function(){t._sandbox||(t._sandbox=new n),t._sandbox.get.apply(t._sandbox,arguments)},Sandbox:n};"function"==typeof define?define(function(){return t}):"object"==typeof module?module.exports=t:e.JSONP=t}(window,window.HTMLIFrameElement?"sandbox"in HTMLIFrameElement.prototype:!1);